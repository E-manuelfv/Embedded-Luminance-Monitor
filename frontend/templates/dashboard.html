<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sensor Monitor</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            background-color: #eef1f5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .sidebar {
            width: 240px;
            min-height: 100vh;
            background: linear-gradient(180deg, #0d2b45, #092035);
            color: white;
            position: fixed;
        }
        .sidebar a {
            color: #cfd8dc;
            text-decoration: none;
            display: block;
            padding: 10px 20px;
            transition: 0.3s;
        }
        .sidebar a:hover {
            background-color: #12395c;
            color: white;
            border-left: 4px solid #0d6efd;
        }
        .content {
            margin-left: 240px;
            padding: 20px;
        }
        .card-metric {
            border-left: 5px solid #0d6efd;
            transition: transform 0.2s;
        }
        .card-metric:hover {
            transform: translateY(-5px);
        }
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: relative;
                min-height: auto;
            }
            .content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>

<div class="sidebar p-3 text-center">
    <h4>Embedded Sensor Monitor Platform</h4>
    <!-- <small class="text-white-50">LDR â€¢ Firebase â€¢ MQTT</small> -->
    <hr class="border-light">
    <nav class="text-start">
        <a href="/">Dashboard</a>
        <a href="#">ConfiguraÃ§Ãµes</a>
        <a href="#">Sobre</a>
    </nav>
</div>

<div class="content">
    <h3 class="mb-4 border-bottom pb-2">ðŸ“Š Dashboard â€“ Luminosidade</h3>

    <!-- MÃ‰TRICAS -->
    <div class="row mb-4">
        <div class="col-md-4 mb-3">
            <div class="card card-metric shadow-sm">
                <div class="card-body">
                    <small class="text-muted">Leitura Bruta</small>
                    <h2 id="rawValue" class="text-primary">--</h2>
                </div>
            </div>
        </div>

        <div class="col-md-4 mb-3">
            <div class="card card-metric shadow-sm" style="border-left-color:#198754;">
                <div class="card-body">
                    <small class="text-muted">Porcentagem</small>
                    <h2 id="percentValue" class="text-success">--%</h2>
                </div>
            </div>
        </div>

        <div class="col-md-4 mb-3">
            <div class="card card-metric shadow-sm" style="border-left-color:#ffc107;">
                <div class="card-body">
                    <small class="text-muted">Status</small>
                    <h2 id="statusText" class="text-warning">--</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- VISUAL -->
    <div class="row">
        <div class="col-md-8 mb-3">
            <div class="card shadow-sm">
                <div class="card-header bg-white fw-bold">
                    Intensidade da Luz
                </div>
                <div class="card-body">
                    <div class="progress" style="height:30px;">
                        <div id="progressBar"
                             class="progress-bar bg-info"
                             style="width:0%">
                            0%
                        </div>
                    </div>
                    <p class="mt-3 text-muted">
                        AtualizaÃ§Ã£o automÃ¡tica a cada 3 segundos.
                    </p>
                </div>
            </div>
        </div>

        <div class="col-md-4 mb-3">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-white fw-bold">
                    GrÃ¡fico
                </div>
                <div class="card-body">
                    <canvas id="donutChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let chart;

async function loadData() {
    const res = await fetch("/api/data");
    const data = await res.json();

    if (!data) return;

    const percent = data.percent;

    document.getElementById("rawValue").textContent = data.raw;
    document.getElementById("percentValue").textContent = percent + "%";
    document.getElementById("statusText").textContent = data.status;

    const bar = document.getElementById("progressBar");
    bar.style.width = percent + "%";
    bar.textContent = percent + "%";

    if (!chart) {
        const ctx = document.getElementById("donutChart");
        chart = new Chart(ctx, {
            type: "doughnut",
            data: {
                labels: ["Luz", "Escuro"],
                datasets: [{
                    data: [percent, 100 - percent],
                    backgroundColor: ["#0d6efd", "#e9ecef"]
                }]
            },
            options: {
                plugins: {
                    legend: { position: "bottom" }
                }
            }
        });
    } else {
        chart.data.datasets[0].data = [percent, 100 - percent];
        chart.update();
    }
}

setInterval(loadData, 3000);
loadData();
</script>

</body>
</html>
